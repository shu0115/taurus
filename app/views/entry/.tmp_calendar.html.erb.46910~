<span class="menu_title">カレンダー</span><br />

<br />

<%= link_to( "今月", :action => 'calendar', :date => Date.new( Time.now.year, Time.now.month, Time.now.day ) ) -%><br />

<br />
<%# 前年 %>
<%= link_to( "#{@now_date.years_ago(1).year}年", :action=>'calendar', :date=> @now_date.years_ago(1) ) -%>
<%# 今年 %>
 | <b><%= "#{@now_date.year}年" -%></b>

<%# 翌年 %>
 | <%= link_to( "#{@now_date.years_since(1).year}年", :action=>'calendar', :date=> @now_date.years_since(1) ) -%>
<br />

<br />

<%# 月 %>
<% if @now_date.month == 1 %><b><%= "1月" -%></b><% else %><%= link_to( "1月", :action => 'calendar', :date => Date.new( @now_date.year, 1, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 2 %><b><%= "2月" -%></b><% else %><%= link_to( "2月", :action => 'calendar', :date => Date.new( @now_date.year, 2, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 3 %><b><%= "3月" -%></b><% else %><%= link_to( "3月", :action => 'calendar', :date => Date.new( @now_date.year, 3, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 4 %><b><%= "4月" -%></b><% else %><%= link_to( "4月", :action => 'calendar', :date => Date.new( @now_date.year, 4, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 5 %><b><%= "5月" -%></b><% else %><%= link_to( "5月", :action => 'calendar', :date => Date.new( @now_date.year, 5, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 6 %><b><%= "6月" -%></b><% else %><%= link_to( "6月", :action => 'calendar', :date => Date.new( @now_date.year, 6, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 7 %><b><%= "7月" -%></b><% else %><%= link_to( "7月", :action => 'calendar', :date => Date.new( @now_date.year, 7, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 8 %><b><%= "8月" -%></b><% else %><%= link_to( "8月", :action => 'calendar', :date => Date.new( @now_date.year, 8, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 9 %><b><%= "9月" -%></b><% else %><%= link_to( "9月", :action => 'calendar', :date => Date.new( @now_date.year, 9, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 10 %><b><%= "10月" -%></b><% else %><%= link_to( "10月", :action => 'calendar', :date => Date.new( @now_date.year, 10, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 11 %><b><%= "11月" -%></b><% else %><%= link_to( "11月", :action => 'calendar', :date => Date.new( @now_date.year, 11, @now_date.day ) ) -%><% end -%>
　<% if @now_date.month == 12 %><b><%= "12月" -%></b><% else %><%= link_to( "12月", :action => 'calendar', :date => Date.new( @now_date.year, 12, @now_date.day ) ) -%><% end -%>

<br />

<% if false %>
<%# 前3ヶ月 %>
<%= link_to( "#{(@now_date << 3).year}年#{(@now_date << 3).month}月", :action=>'calendar', :date=> (@now_date << 3) ) -%>
 | <%= link_to( "#{(@now_date << 2).year}年#{(@now_date << 2).month}月", :action=>'calendar', :date=> (@now_date << 2) ) -%>
 | <%= link_to( "#{(@now_date << 1).year}年#{(@now_date << 1).month}月", :action=>'calendar', :date=> (@now_date << 1) ) -%>
<%# 今月 %>
 | <b><%= "#{@now_date.year}年#{@now_date.month}月" -%></b>
<%# 後3ヶ月 %>
 | <%= link_to( "#{(@now_date >> 1).year}年#{(@now_date >> 1).month}月", :action=>'calendar', :date=> (@now_date >> 1) ) -%>
 | <%= link_to( "#{(@now_date >> 2).year}年#{(@now_date >> 2).month}月", :action=>'calendar', :date=> (@now_date >> 2) ) -%>
 | <%= link_to( "#{(@now_date >> 3).year}年#{(@now_date >> 3).month}月", :action=>'calendar', :date=> (@now_date >> 3) ) -%>
<br />
<% end %>

<br />

<b><%= "#{@now_date.year}年#{@now_date.month}月" -%></b><br />

<br />
<%= link_to 'List', :action => "list", :date => @now_date %><br />
<br />

<table class="calendar">

	<tr>
		<th class="sunday">日</th>
		<th>月</th>
		<th>火</th>
		<th>水</th>
		<th>木</th>
		<th>金</th>
		<th class="saturday">土</th>
	</tr>

	<%# カレンダーテーブル %>
	<% @calendar_matrix.each_with_index{ | value, index | %>

    <% style_class = "" %>

    <%# カレンダー日付 %>
    <% calendar_date = Date.new( @now_date.strftime("%Y").to_i, @now_date.strftime("%m").to_i, sprintf("%02d", value[:days].to_i).to_i ) if value[:days].to_s != "　" %>

    <%# 当日スケジュール取得 %>
    <% today_schedules = @month_schedules["#{@now_date.strftime("%Y")}-#{@now_date.strftime("%m")}-#{sprintf("%02d", value[:days].to_i)}"] %>

    <%# 祝日判定 %>
    <% holiday_judge = Utility.holiday_ja?( calendar_date ) unless calendar_date.blank? %>

    <%# 今日 %>
    <% if Date.today == calendar_date %>
      <% style_class += "today" %>
    <% end %>

    <% if value[:week_day].to_i == 0 or holiday_judge == true %>
      <%# 日曜日／祝日 %>
      <% if style_class.blank? %>
        <% style_class += "sunday" %>
      <% else %>
        <% style_class += " sunday" %>
      <% end %>
    <% elsif value[:week_day].to_i == 6 %>
      <%# 土曜日 %>
      <% if style_class.blank? %>
        <% style_class += "saturday" %>
      <% else %>
        <% style_class += " saturday" %>
      <% end %>
    <% end %>

    <%# 週始め %>
    <% if value[:week_day].to_i == 0 %><tr><% end %>

    <td class="<%= style_class %>">
      <%#= value[:days] %>
      <span id="schedule_field_<%= index %>">
        <%# 日付(新規作成リンク) %>
        <% if value[:days].to_s != "　" %><%= link_to value[:days], { :action => "new", :schedule_date_year => @now_date.year, :schedule_date_month => @now_date.month, :schedule_date_day => value[:days], :date => @now_date } %><% end %>
      </span><br />
      <% unless today_schedules.blank? %>
        <% today_schedules.each_with_index{ | value, index | %>
          <%# スケジュールリンク %>
          <span class="schedule_title"><%= link_to value.title, { :action => "show", :id => value.id, :date => @now_date }, :title => value.note %></span><br />
        <% } %>
      <% end %>
    </td>

    <%# 週終わり %>
    <% if value[:week_day].to_i == 6 %></tr><% end %>

	<% } %>

</table>

<br />

<%= link_to 'List', :action => "list", :date => @now_date %>

<br />
<br />
